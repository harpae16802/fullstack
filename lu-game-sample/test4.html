<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Balloon Shooter Game</title>
    <style>
      body {
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        background-color: #f0f0f0;
      }

      #game-container {
        position: relative;
        width: 1050px;
        height: 610px;
        border: 2px solid #000;
        overflow: hidden;
        border-radius: 70px;
      }

      .balloon {
        position: absolute;
        width: 70px;
        height: 70px;
        overflow: visible;
        /* border-radius: 50%; */
        cursor: pointer;
        display: flex;
        justify-content: center;
        align-items: flex-start;

        /* padding-top: 18px; */
        line-height: 75px;
        font-size: 24px;
        color: white;
        font-weight: bold;
        animation: moveUp 4s linear forwards;
      }
      .balloonimg{
        position: absolute;
        background-image: url('./blue.png'); /* 替換成你的圖片路徑 */
        background-size: cover; /*調整圖片大小以填滿氣球 */
        text-align: center;
        width: 70px;
        height: 120px;


        /* background-color: #000; */
      }


      @keyframes moveUp {
        from {
          bottom: -70px;
        }
        to {
          bottom: 700px;
        }
      }

      #score {
        position: absolute;
        top: 10px;
        right: 10px;
        font-size: 24px;
      }

      #timer {
        position: absolute;
        top: 10px;
        left: 10px;
        font-size: 24px;
      }
    </style>
  </head>
  <body>
    <div id="game-container">
      <div id="score">Score: 0</div>
      <div id="timer">Time: 00</div>
    </div>

    <script>
       // 獲得遊戲容器、分數顯示區和計時器顯示區
      const gameContainer = document.getElementById('game-container');
      const scoreDisplay = document.getElementById('score');
      const timerDisplay = document.getElementById('timer');


      //初始化分數和計時器
      let score = 0;
      let timer = 30;

      // 定義遊戲循環間隔的變數
      let gameInterval;

      // 關卡條件
      const levelConfigs = [
        { level: 1, time: 30, speed: 4 },
        { level: 2, time: 30, speed: 3 },
        { level: 3, time: 15, speed: 3 },
        { level: 4, time: 15, speed: 2 },
        { level: 5, time: 10, speed: 2 },
      ];

      // 氣球的設定
      const balloonConfigs = [
          { color: 'green',name:'10', points: 10 },
          { color: 'blue',name:'30', points: 30 },
          { color: 'red',name:'50', points: 50 },
          { color: 'purple', name:'x2',points: 'x2' }, // 分數為目前分數的兩倍
          { color: 'orange',name:'0', points:'0'} // 分數為0
      ];

      // 製作氣球
      function createBalloon(speed) {
          const numBalloons = Math.floor(Math.random() * 4) + 1; // 生成 2 到 3 個氣球
          for (let i = 0; i < numBalloons; i++) {
              const balloonConfig = chooseBalloonConfig(); // 隨機選擇氣球配置
              const balloon = document.createElement('div');
              const balloonimg = document.createElement('div');

              // 根據配置設定氣球的樣式和屬性
              balloon.classList.add('balloon');
              balloon.style.left = `${Math.random() * (gameContainer.offsetWidth - 50)}px`;
              const points = balloonConfig.points; // 分數
              balloon.dataset.points = points; // 點選氣球時的分數
              balloon.addEventListener('click', () => {
                  popBalloon(balloon);
              });
              balloon.style.animation = `moveUp ${speed}s linear forwards`;
              balloonimg.classList.add('balloonimg');
              const name= balloonConfig.name // 名字
              balloonimg.textContent = name; // 給氣球的名字
              const imageUrl = `url('./${balloonConfig.color}.png')`; // 根據氣球顏色設定不同的圖片路徑
              balloonimg.style.backgroundImage = imageUrl;


                 // 將氣球圖片添加到氣球中
                balloon.appendChild(balloonimg);

                // 將氣球添加到遊戲容器中
                gameContainer.appendChild(balloon);

              setTimeout(() => {
                  if (balloon.parentNode === gameContainer) {
                      balloon.remove();
                      updateScore(0);
                  }
              }, 5000);
          }
      }

      // 跟據氣球配置的概率隨機選擇氣球配置
      function chooseBalloonConfig() {
          const randomIndex = Math.floor(Math.random() * balloonConfigs.length);
          return balloonConfigs[randomIndex];
      }

      // 點擊氣球時觸發的函數
      function popBalloon(balloon) {
          // 獲取氣球的分數並將其轉為整數
          const points = parseInt(balloon.dataset.points);
          // 獲取氣球的名稱
          const balloonName = balloon.textContent;

          // 移除被點擊的氣球
          balloon.remove();

          // 更新分數
          updateScore(points, balloonName);
      }

      // 更新分數的函式
      function updateScore(points, balloonName) {
        if (balloonName === "0") {
        score = 0; // 如果氣球名字是 0 分數歸 0
        } else if (balloonName === "x2") {
        score *= 2; // 如果氣球名字是 2 分數乘以 2
        } else {
        score += points; // 都不是時 將分數累加
        }

          // 更新分數顯示的內容
          scoreDisplay.textContent = `Score: ${score}`;
      }


      // 開始遊戲的函式
      function startGame(level) {
        const levelConfig = levelConfigs.find(config => config.level === level);
        timer = levelConfig.time;
        const speed = levelConfig.speed;
          // 設置遊戲循環 每秒調用一次 createBalloon 函式生成氣球
          gameInterval = setInterval(() => {
              createBalloon(speed);
          }, 1000);

          //在規定時間後結束遊戲
          setTimeout(() => {
              clearInterval(gameInterval); // 清除遊戲循環
              alert(`Game Over! Your score is ${score}`); // 彈出提示框顯示最終分數
          }, timer * 1000);

          // 每秒更新一次剩餘時間 並更新計時器
          setInterval(() => {
              timer--;
              timerDisplay.textContent = `Time: ${timer}`;
          }, 1000);
      }

      // 啟動遊戲
      startGame(5);
    </script>
  </body>
</html>
